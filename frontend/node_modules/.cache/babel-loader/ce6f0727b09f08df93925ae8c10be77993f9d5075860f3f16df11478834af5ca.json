{"ast":null,"code":"import \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.filter.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport \"core-js/modules/es.json.stringify.js\";\nimport \"core-js/modules/esnext.json.parse.js\";\nimport \"core-js/modules/web.dom-exception.stack.js\";\nimport \"core-js/modules/web.url-search-params.delete.js\";\nimport \"core-js/modules/web.url-search-params.has.js\";\nimport \"core-js/modules/web.url-search-params.size.js\";\n// 1. 修正 Import 大写问题\nimport axios from 'axios';\nimport { ElMessage } from 'element-plus';\n\n// 2. 引入图标，建议给 Link 起个别名防止冲突\nimport { Setting, Sunny, Moon, FolderOpened, Refresh, Link as LinkIcon,\n// 关键：重命名为 LinkIcon\nUpload, DocumentCopy, Delete } from '@element-plus/icons-vue';\nexport default {\n  // 3. 注册组件\n  components: {\n    Setting,\n    Sunny,\n    Moon,\n    FolderOpened,\n    Refresh,\n    LinkIcon,\n    // 使用别名注册\n    Upload,\n    DocumentCopy,\n    Delete\n  },\n  // ... 你的 data() 和 methods 等其他代码 ...\n\n  data() {\n    return {\n      sshInfo: {\n        hostname: '',\n        port: '',\n        username: '',\n        password: '',\n        privateKey: '',\n        passphrase: '',\n        command: ''\n      },\n      privateKeyFileName: '',\n      generatedLink: '',\n      isDarkTheme: false,\n      // GitHub 相关数据\n      showGithubDialog: false,\n      showCloudListDialog: false,\n      cloudList: [],\n      githubLoading: false,\n      githubConfig: {\n        token: '',\n        owner: '',\n        repo: '',\n        path: 'ssh_links.json'\n      }\n    };\n  },\n  watch: {\n    sshInfo: {\n      handler(newVal) {\n        localStorage.setItem('sshInfo', JSON.stringify(newVal));\n      },\n      deep: true\n    }\n  },\n  created() {\n    const ghConfig = localStorage.getItem('gh_config');\n    if (ghConfig) {\n      this.githubConfig = JSON.parse(ghConfig);\n    }\n    const savedInfo = localStorage.getItem('connectionInfo');\n    if (savedInfo) {\n      const info = JSON.parse(savedInfo);\n      this.sshInfo = {\n        hostname: info.hostname || '',\n        port: info.port || '',\n        username: info.username || '',\n        password: info.password || '',\n        privateKey: info.privateKey || '',\n        passphrase: info.passphrase || '',\n        command: info.command || ''\n      };\n      if (info.privateKey) {\n        this.privateKeyFileName = '已保存的密钥文件';\n      }\n    }\n    const savedTheme = localStorage.getItem('isDarkTheme');\n    if (savedTheme !== null) {\n      this.isDarkTheme = savedTheme === 'true';\n    }\n\n    // 动态加载 FontAwesome (用于终端图标)\n    const link = document.createElement('link');\n    link.rel = 'stylesheet';\n    link.href = 'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css';\n    document.head.appendChild(link);\n  },\n  methods: {\n    saveGithubSettings() {\n      localStorage.setItem('gh_config', JSON.stringify(this.githubConfig));\n      this.showGithubDialog = false;\n      ElMessage.success('GitHub 配置已保存');\n    },\n    async syncToGitHub() {\n      const {\n        token,\n        owner,\n        repo,\n        path\n      } = this.githubConfig;\n      if (!token) {\n        ElMessage.warning('请先配置 GitHub 信息');\n        this.showGithubDialog = true;\n        return;\n      }\n      if (!this.generatedLink) {\n        this.onGenerateLink();\n        if (!this.generatedLink) return;\n      }\n      this.githubLoading = true;\n      const apiUrl = `https://api.github.com/repos/${owner}/${repo}/contents/${path}`;\n      const headers = {\n        'Authorization': `token ${token}`\n      };\n      const uniqueKey = `${this.sshInfo.hostname}_${this.sshInfo.username}`;\n      const dataToSave = {\n        url: this.generatedLink,\n        hostname: this.sshInfo.hostname,\n        username: this.sshInfo.username,\n        updated_at: new Date().toLocaleString()\n      };\n      try {\n        let existingContent = {};\n        let sha = null;\n        try {\n          const res = await axios.get(apiUrl, {\n            headers\n          });\n          sha = res.data.sha;\n          const decodedContent = decodeURIComponent(escape(window.atob(res.data.content)));\n          existingContent = JSON.parse(decodedContent);\n        } catch (error) {\n          if (!error.response || error.response.status !== 404) throw error;\n        }\n        existingContent[uniqueKey] = dataToSave;\n        const contentBase64 = window.btoa(unescape(encodeURIComponent(JSON.stringify(existingContent, null, 2))));\n        const payload = {\n          message: `Add SSH Link: ${uniqueKey}`,\n          content: contentBase64\n        };\n        if (sha) payload.sha = sha;\n        await axios.put(apiUrl, payload, {\n          headers\n        });\n        ElMessage.success('链接已保存到 GitHub！');\n      } catch (e) {\n        console.error(e);\n        ElMessage.error('保存失败，请检查配置或网络');\n      } finally {\n        this.githubLoading = false;\n      }\n    },\n    async fetchCloudList() {\n      const {\n        token,\n        owner,\n        repo,\n        path\n      } = this.githubConfig;\n      if (!token) {\n        ElMessage.warning('请先配置 GitHub');\n        this.showGithubDialog = true;\n        return;\n      }\n      this.showCloudListDialog = true;\n      this.githubLoading = true;\n      this.cloudList = [];\n      try {\n        const apiUrl = `https://api.github.com/repos/${owner}/${repo}/contents/${path}`;\n        const res = await axios.get(apiUrl, {\n          headers: {\n            'Authorization': `token ${token}`\n          }\n        });\n        const decodedContent = decodeURIComponent(escape(window.atob(res.data.content)));\n        const jsonContent = JSON.parse(decodedContent);\n        this.cloudList = Object.entries(jsonContent).map(([key, value]) => ({\n          key: key,\n          ...value\n        }));\n      } catch (e) {\n        if (e.response && e.response.status === 404) {\n          this.cloudList = [];\n        } else {\n          ElMessage.error('获取列表失败');\n        }\n      } finally {\n        this.githubLoading = false;\n      }\n    },\n    openSavedUrl(url) {\n      if (url) window.open(url, '_blank');\n    },\n    copySavedUrl(url) {\n      navigator.clipboard.writeText(url).then(() => {\n        ElMessage.success('已复制');\n      });\n    },\n    async deleteFromCloud(key) {\n      const {\n        token,\n        owner,\n        repo,\n        path\n      } = this.githubConfig;\n      this.githubLoading = true;\n      const apiUrl = `https://api.github.com/repos/${owner}/${repo}/contents/${path}`;\n      const headers = {\n        'Authorization': `token ${token}`\n      };\n      try {\n        const res = await axios.get(apiUrl, {\n          headers\n        });\n        const sha = res.data.sha;\n        const decodedContent = decodeURIComponent(escape(window.atob(res.data.content)));\n        const existingContent = JSON.parse(decodedContent);\n        delete existingContent[key];\n        const contentBase64 = window.btoa(unescape(encodeURIComponent(JSON.stringify(existingContent, null, 2))));\n        await axios.put(apiUrl, {\n          message: `Delete ${key}`,\n          content: contentBase64,\n          sha: sha\n        }, {\n          headers\n        });\n        ElMessage.success('删除成功');\n        this.cloudList = this.cloudList.filter(item => item.key !== key);\n      } catch (e) {\n        ElMessage.error('删除失败');\n      } finally {\n        this.githubLoading = false;\n      }\n    },\n    onConnect() {\n      sessionStorage.removeItem('sshInfo');\n      if (!this.sshInfo.hostname) {\n        ElMessage.error('请输入主机地址！');\n        return;\n      }\n      if (!this.sshInfo.username) {\n        ElMessage.error('请输入用户名！');\n        return;\n      }\n      if (!this.sshInfo.password && !this.sshInfo.privateKey) {\n        ElMessage.error('请输入密码或上传密钥！');\n        return;\n      }\n      if (this.sshInfo.privateKey && this.sshInfo.privateKey.trim()) {\n        this.sshInfo.password = '';\n      } else if (this.sshInfo.password) {\n        this.sshInfo.privateKey = '';\n        this.sshInfo.passphrase = '';\n        this.privateKeyFileName = '';\n      }\n      const connectionInfo = {\n        hostname: this.sshInfo.hostname,\n        port: this.sshInfo.port || 22,\n        username: this.sshInfo.username,\n        password: this.sshInfo.password || '',\n        privateKey: this.sshInfo.privateKey || '',\n        passphrase: this.sshInfo.passphrase || '',\n        command: this.sshInfo.command || ''\n      };\n      localStorage.setItem('connectionInfo', JSON.stringify(connectionInfo));\n      const query = {\n        hostname: encodeURIComponent(this.sshInfo.hostname),\n        port: Number(this.sshInfo.port) || 22,\n        username: encodeURIComponent(this.sshInfo.username),\n        command: encodeURIComponent(this.sshInfo.command || '')\n      };\n      if (this.sshInfo.privateKey && this.sshInfo.privateKey.trim()) {\n        sessionStorage.setItem('sshInfo', JSON.stringify(this.sshInfo));\n        query.useKey = 1;\n      } else if (this.sshInfo.password) {\n        query.password = btoa(this.sshInfo.password);\n      }\n      const url = this.$router.resolve({\n        path: '/terminal',\n        query\n      }).href;\n      window.open(url, '_blank');\n    },\n    onReset() {\n      this.sshInfo = {\n        hostname: '',\n        port: '',\n        username: '',\n        password: '',\n        command: '',\n        privateKey: '',\n        passphrase: ''\n      };\n      this.privateKeyFileName = '';\n      this.generatedLink = '';\n      localStorage.removeItem('connectionInfo');\n      sessionStorage.removeItem('sshInfo');\n      // Vue 3 中通常不建议直接操作 DOM，但为了重置 input file 暂时保留\n      const fileInput = document.querySelector('.upload-key input[type=\"file\"]');\n      if (fileInput) {\n        fileInput.value = '';\n      }\n    },\n    onGenerateLink() {\n      if (this.sshInfo.privateKey) {\n        ElMessage.warning('密钥方式登录不支持生成快捷链接，请改用密码登录方式');\n        return;\n      }\n      if (!this.sshInfo.hostname) {\n        ElMessage.error('请输入主机地址！');\n        return;\n      }\n      if (!this.sshInfo.username) {\n        ElMessage.error('请输入用户名！');\n        return;\n      }\n      if (!this.sshInfo.password && !this.sshInfo.privateKey) {\n        ElMessage.error('请输入密码或上传密钥以生成链接！');\n        return;\n      }\n      const url = new URL(window.location.href);\n      url.pathname = '/terminal';\n      const cleanSshInfo = {};\n      const infoToProcess = {\n        ...this.sshInfo,\n        port: this.sshInfo.port || 22\n      };\n      for (const key in infoToProcess) {\n        if (infoToProcess[key] !== '' && infoToProcess[key] !== null) {\n          if (key === 'password') {\n            cleanSshInfo[key] = btoa(infoToProcess[key]);\n          } else {\n            cleanSshInfo[key] = infoToProcess[key];\n          }\n        }\n      }\n      url.search = new URLSearchParams(cleanSshInfo).toString();\n      this.generatedLink = url.href;\n    },\n    copyLink() {\n      if (this.generatedLink) {\n        navigator.clipboard.writeText(this.generatedLink).then(() => {\n          ElMessage.success('链接已复制！');\n        }).catch(err => {\n          ElMessage.error('复制失败: ' + err);\n        });\n      }\n    },\n    toggleTheme() {\n      this.isDarkTheme = !this.isDarkTheme;\n      localStorage.setItem('isDarkTheme', this.isDarkTheme);\n      // 调用 main.js 中定义的全局 window.setTheme (如果有的话)，或手动触发\n      if (window.setTheme) {\n        window.setTheme(this.isDarkTheme ? 'dark' : 'light');\n      }\n    },\n    handlePrivateKeyUpload(file) {\n      this.sshInfo.password = '';\n      const reader = new FileReader();\n      reader.onload = e => {\n        this.sshInfo.privateKey = e.target.result;\n        this.privateKeyFileName = file.name;\n      };\n      reader.readAsText(file);\n      return false;\n    }\n  }\n};","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}