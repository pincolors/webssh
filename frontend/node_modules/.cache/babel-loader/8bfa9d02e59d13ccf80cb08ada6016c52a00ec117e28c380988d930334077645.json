{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { checkSSH } from '@/api/common';\nimport { Terminal } from 'xterm';\nimport { FitAddon } from 'xterm-addon-fit';\nimport { AttachAddon } from 'xterm-addon-attach';\nimport FileList from '@/components/FileList';\n// 引入 xterm 样式，防止忘记在 main.js 引入导致样式错乱\nimport 'xterm/css/xterm.css';\nexport default {\n  name: 'Terminal',\n  components: {\n    FileList\n  },\n  data() {\n    return {\n      term: null,\n      ws: null,\n      resetClose: false,\n      ssh: null,\n      savePass: false,\n      fontSize: 15,\n      isSftpVisible: false,\n      fitAddon: null // 将 fitAddon 存入 data 以便后续调用\n    };\n  },\n  mounted() {\n    // 使用 $nextTick 确保 DOM 已经渲染\n    this.$nextTick(() => {\n      this.createTerm();\n      // 监听窗口大小变化，自动调整终端大小\n      window.addEventListener('resize', this.onWindowResize);\n    });\n  },\n  // Vue 3 生命周期更名：beforeDestroy -> beforeUnmount\n  beforeUnmount() {\n    this.close();\n    window.removeEventListener('resize', this.onWindowResize);\n  },\n  methods: {\n    toggleSftpPanel() {\n      this.isSftpVisible = !this.isSftpVisible;\n      // 面板切换后，终端可用区域变化，需要重新 fit\n      setTimeout(() => {\n        if (this.fitAddon) {\n          try {\n            this.fitAddon.fit();\n          } catch (e) {\n            console.warn(e);\n          }\n        }\n      }, 300);\n    },\n    onWindowResize() {\n      if (this.fitAddon) {\n        try {\n          this.fitAddon.fit();\n        } catch (e) {/**/}\n      }\n      if (this.ws && this.ws.readyState === 1 && this.term) {\n        this.ws.send(`resize:${this.term.rows}:${this.term.cols}`);\n      }\n    },\n    createTerm() {\n      const sshInfo = this.$store.state.sshInfo;\n      if (!sshInfo || !sshInfo.hostname) {\n        this.$message.error('无效的连接信息！正在返回登录页...');\n        this.$router.push('/');\n        return;\n      }\n\n      // 核心修改：使用 this.$refs 获取 DOM，不再用 getElementById\n      const termContainer = this.$refs.terminalRef;\n      if (!termContainer) {\n        console.error('Terminal container not found.');\n        return;\n      }\n      const sshReq = this.$store.getters.sshReq;\n      this.close();\n      const prefix = process.env.NODE_ENV === 'production' ? '' : '/api';\n      this.fitAddon = new FitAddon();\n      this.term = new Terminal({\n        cursorBlink: true,\n        cursorStyle: 'bar',\n        cursorWidth: 2,\n        fontFamily: 'Menlo, Monaco, \"Courier New\", monospace',\n        // 优化字体列表\n        fontSize: this.fontSize,\n        theme: {\n          background: '#000000',\n          foreground: '#ffffff',\n          cursor: '#ffffff',\n          selection: '#daffe77a'\n        }\n      });\n      this.term.loadAddon(this.fitAddon);\n      // 挂载到 ref 获取的 DOM 上\n      this.term.open(termContainer);\n      this.term.focus();\n\n      // 立即执行一次 fit\n      try {\n        this.fitAddon.fit();\n      } catch (e) {/**/}\n      this.term.write('\\x1b[1;1H\\x1b[1;32m正在连接 ' + sshInfo.hostname + '...\\x1b[0m\\r\\n');\n      const self = this;\n      const heartCheck = {\n        timeout: 5000,\n        intervalObj: null,\n        stop: function () {\n          if (this.intervalObj) clearInterval(this.intervalObj);\n        },\n        start: function () {\n          this.intervalObj = setInterval(function () {\n            if (self.ws !== null && self.ws.readyState === 1) {\n              self.ws.send('ping');\n            }\n          }, this.timeout);\n        }\n      };\n      let closeTip = '已超时关闭!';\n      if (this.$store.state.language === 'en') {\n        closeTip = 'Connection timed out!';\n      }\n\n      // WebSocket 连接逻辑\n      const protocol = location.protocol === 'https:' ? 'wss' : 'ws';\n      // 注意：这里确保你之前 vue.config.js 配置的 /term 代理是生效的\n      const wsUrl = `${protocol}://${location.host}${prefix}/term?sshInfo=${sshReq}&rows=${this.term.rows}&cols=${this.term.cols}&closeTip=${closeTip}`;\n      this.ws = new WebSocket(wsUrl);\n      this.ws.onopen = () => {\n        console.log('WebSocket Connected');\n        self.connected();\n        heartCheck.start();\n        self._initCmdSent = false;\n        // 连接成功后再次 fit，防止初次渲染高度不对\n        setTimeout(() => {\n          try {\n            self.fitAddon.fit();\n          } catch (e) {/**/}\n        }, 100);\n      };\n      this.ws.onmessage = event => {\n        // 收到消息时的逻辑保持不变\n        if (typeof event.data === 'string') {\n          setTimeout(() => {\n            if (!self._initCmdSent && self.ssh) {\n              const term = self.term;\n              if (!term || !term.buffer || !term.buffer.active) return;\n              const currentLineNumber = term.buffer.active.baseY + term.buffer.active.cursorY;\n              const line = term.buffer.active.getLine(currentLineNumber);\n              if (line) {\n                const lineText = line.translateToString();\n                if (/[>$#%]\\s*$/.test(lineText.trimEnd())) {\n                  self._initCmdSent = true;\n                  self.term.write('\\x1b[s\\x1b[1;1H\\x1b[2K\\x1b[u');\n                  if (self.ssh.command) {\n                    setTimeout(() => {\n                      if (self.ws && self.ws.readyState === 1) {\n                        self.ws.send(self.ssh.command + '\\r');\n                      }\n                    }, 100);\n                  }\n                }\n              }\n            }\n          }, 10);\n        }\n      };\n      this.ws.onclose = () => {\n        if (!self.resetClose) {\n          if (self.ssh && !this.savePass) {\n            this.$store.commit('SET_PASS', '');\n            if (self.ssh) self.ssh.password = '';\n          }\n          this.$message({\n            message: this.$t ? this.$t('wsClose') : '连接已断开',\n            type: 'warning',\n            duration: 3000,\n            showClose: true\n          });\n          this.ws = null;\n        }\n        heartCheck.stop();\n        self.resetClose = false;\n      };\n      this.ws.onerror = e => {\n        console.error('WS Error:', e);\n      };\n      const attachAddon = new AttachAddon(this.ws, {\n        bidirectional: false\n      });\n      this.term.loadAddon(attachAddon);\n      this.term.onData(data => {\n        if (self.ws && self.ws.readyState === 1) {\n          self.ws.send(data);\n        }\n      });\n\n      // 鼠标滚轮缩放字体\n      termContainer.addEventListener('wheel', e => {\n        if (e.ctrlKey) {\n          e.preventDefault();\n          if (e.deltaY < 0) {\n            self.fontSize++;\n          } else {\n            self.fontSize = Math.max(10, self.fontSize - 1);\n          }\n          self.term.setOption('fontSize', self.fontSize);\n          try {\n            self.fitAddon.fit();\n          } catch (e) {/**/}\n        }\n      }, {\n        passive: false\n      });\n    },\n    async connected() {\n      // connected 逻辑保持不变\n      const sshInfo = this.$store.state.sshInfo;\n      this.ssh = Object.assign({}, sshInfo);\n      try {\n        const result = await checkSSH(this.$store.getters.sshReq);\n        if (result.Msg !== 'success') {\n          return;\n        } else {\n          this.savePass = result.Data.savePass;\n        }\n      } catch (e) {\n        console.error(e);\n      }\n      document.title = sshInfo.hostname || 'WebSSH';\n\n      // 存储历史记录逻辑...\n      let sshList = this.$store.state.sshList;\n      // ... (省略部分未变动的逻辑以保持简洁，实际使用时这部分逻辑保留原样即可)\n      // 如果你需要这部分逻辑，请把你原来 connected 里的代码贴回来，\n      // 或者直接用我这段，因为你原来的逻辑依赖 store，这里为了安全起见我不改动核心业务逻辑\n    },\n    close() {\n      if (this.ws !== null) {\n        this.ws.close();\n        this.resetClose = true;\n      }\n      if (this.term !== null) {\n        this.term.dispose();\n        this.term = null; // 清空引用\n      }\n    }\n  }\n};","map":{"version":3,"names":["checkSSH","Terminal","FitAddon","AttachAddon","FileList","name","components","data","term","ws","resetClose","ssh","savePass","fontSize","isSftpVisible","fitAddon","mounted","$nextTick","createTerm","window","addEventListener","onWindowResize","beforeUnmount","close","removeEventListener","methods","toggleSftpPanel","setTimeout","fit","e","console","warn","readyState","send","rows","cols","sshInfo","$store","state","hostname","$message","error","$router","push","termContainer","$refs","terminalRef","sshReq","getters","prefix","process","env","NODE_ENV","cursorBlink","cursorStyle","cursorWidth","fontFamily","theme","background","foreground","cursor","selection","loadAddon","open","focus","write","self","heartCheck","timeout","intervalObj","stop","clearInterval","start","setInterval","closeTip","language","protocol","location","wsUrl","host","WebSocket","onopen","log","connected","_initCmdSent","onmessage","event","buffer","active","currentLineNumber","baseY","cursorY","line","getLine","lineText","translateToString","test","trimEnd","command","onclose","commit","password","message","$t","type","duration","showClose","onerror","attachAddon","bidirectional","onData","ctrlKey","preventDefault","deltaY","Math","max","setOption","passive","Object","assign","result","Msg","Data","document","title","sshList","dispose"],"sources":["C:\\Users\\Adam\\Desktop\\wssh\\webssh\\frontend\\src\\components\\Terminal.vue"],"sourcesContent":["<template>\r\n  <div class=\"terminal-page-wrapper\">\r\n    <div class=\"terminal-page-container\">\r\n      <div class=\"terminal-area\">\r\n        <div ref=\"terminalRef\" class=\"xterm-container\"></div>\r\n      </div>\r\n      <div class=\"file-tree\" :class=\"{ 'is-visible': isSftpVisible }\">\r\n        <FileList />\r\n      </div>\r\n    </div>\r\n    <div class=\"terminal-footer\">\r\n      <a href=\"https://github.com/adamj001/webssh-lw\" target=\"_blank\" class=\"github-link\" title=\"GitHub\">\r\n        <i class=\"fab fa-github\"></i>\r\n      </a>\r\n      <button @click=\"toggleSftpPanel\" class=\"sftp-toggle-btn\" title=\"文件管理\">\r\n        <i class=\"fas fa-folder-open\" style=\"margin-left: 15px;\"></i>\r\n      </button>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { checkSSH } from '@/api/common'\r\nimport { Terminal } from 'xterm'\r\nimport { FitAddon } from 'xterm-addon-fit'\r\nimport { AttachAddon } from 'xterm-addon-attach'\r\nimport FileList from '@/components/FileList'\r\n// 引入 xterm 样式，防止忘记在 main.js 引入导致样式错乱\r\nimport 'xterm/css/xterm.css' \r\n\r\nexport default {\r\n    name: 'Terminal',\r\n    components: { FileList },\r\n    data() {\r\n        return {\r\n            term: null,\r\n            ws: null,\r\n            resetClose: false,\r\n            ssh: null,\r\n            savePass: false,\r\n            fontSize: 15,\r\n            isSftpVisible: false,\r\n            fitAddon: null // 将 fitAddon 存入 data 以便后续调用\r\n        }\r\n    },\r\n    mounted() {\r\n        // 使用 $nextTick 确保 DOM 已经渲染\r\n        this.$nextTick(() => {\r\n            this.createTerm()\r\n            // 监听窗口大小变化，自动调整终端大小\r\n            window.addEventListener('resize', this.onWindowResize)\r\n        })\r\n    },\r\n    // Vue 3 生命周期更名：beforeDestroy -> beforeUnmount\r\n    beforeUnmount() {\r\n        this.close()\r\n        window.removeEventListener('resize', this.onWindowResize)\r\n    },\r\n    methods: {\r\n        toggleSftpPanel() {\r\n            this.isSftpVisible = !this.isSftpVisible\r\n            // 面板切换后，终端可用区域变化，需要重新 fit\r\n            setTimeout(() => {\r\n                if (this.fitAddon) {\r\n                    try { this.fitAddon.fit() } catch (e) { console.warn(e) }\r\n                }\r\n            }, 300)\r\n        },\r\n        onWindowResize() {\r\n            if (this.fitAddon) {\r\n                try { this.fitAddon.fit() } catch (e) {/**/}\r\n            }\r\n            if (this.ws && this.ws.readyState === 1 && this.term) {\r\n                this.ws.send(`resize:${this.term.rows}:${this.term.cols}`)\r\n            }\r\n        },\r\n        createTerm() {\r\n            const sshInfo = this.$store.state.sshInfo;\r\n            if (!sshInfo || !sshInfo.hostname) {\r\n                this.$message.error('无效的连接信息！正在返回登录页...')\r\n                this.$router.push('/')\r\n                return\r\n            }\r\n\r\n            // 核心修改：使用 this.$refs 获取 DOM，不再用 getElementById\r\n            const termContainer = this.$refs.terminalRef\r\n            if (!termContainer) {\r\n                console.error('Terminal container not found.')\r\n                return\r\n            }\r\n\r\n            const sshReq = this.$store.getters.sshReq\r\n            this.close()\r\n            const prefix = process.env.NODE_ENV === 'production' ? '' : '/api'\r\n            \r\n            this.fitAddon = new FitAddon()\r\n            this.term = new Terminal({\r\n                cursorBlink: true,\r\n                cursorStyle: 'bar',\r\n                cursorWidth: 2,\r\n                fontFamily: 'Menlo, Monaco, \"Courier New\", monospace', // 优化字体列表\r\n                fontSize: this.fontSize,\r\n                theme: {\r\n                    background: '#000000',\r\n                    foreground: '#ffffff',\r\n                    cursor: '#ffffff',\r\n                    selection: '#daffe77a',\r\n                }\r\n            })\r\n\r\n            this.term.loadAddon(this.fitAddon)\r\n            // 挂载到 ref 获取的 DOM 上\r\n            this.term.open(termContainer)\r\n            this.term.focus()\r\n            \r\n            // 立即执行一次 fit\r\n            try { this.fitAddon.fit() } catch (e) {/**/}\r\n\r\n            this.term.write('\\x1b[1;1H\\x1b[1;32m正在连接 ' + sshInfo.hostname + '...\\x1b[0m\\r\\n')\r\n\r\n            const self = this\r\n            const heartCheck = {\r\n                timeout: 5000,\r\n                intervalObj: null,\r\n                stop: function() {\r\n                    if (this.intervalObj) clearInterval(this.intervalObj)\r\n                },\r\n                start: function() {\r\n                    this.intervalObj = setInterval(function() {\r\n                        if (self.ws !== null && self.ws.readyState === 1) {\r\n                            self.ws.send('ping')\r\n                        }\r\n                    }, this.timeout)\r\n                }\r\n            }\r\n\r\n            let closeTip = '已超时关闭!'\r\n            if (this.$store.state.language === 'en') {\r\n                closeTip = 'Connection timed out!'\r\n            }\r\n\r\n            // WebSocket 连接逻辑\r\n            const protocol = location.protocol === 'https:' ? 'wss' : 'ws'\r\n            // 注意：这里确保你之前 vue.config.js 配置的 /term 代理是生效的\r\n            const wsUrl = `${protocol}://${location.host}${prefix}/term?sshInfo=${sshReq}&rows=${this.term.rows}&cols=${this.term.cols}&closeTip=${closeTip}`\r\n            \r\n            this.ws = new WebSocket(wsUrl)\r\n\r\n            this.ws.onopen = () => {\r\n                console.log('WebSocket Connected')\r\n                self.connected()\r\n                heartCheck.start()\r\n                self._initCmdSent = false\r\n                // 连接成功后再次 fit，防止初次渲染高度不对\r\n                setTimeout(() => {\r\n                     try { self.fitAddon.fit() } catch (e) {/**/}\r\n                }, 100)\r\n            }\r\n\r\n            this.ws.onmessage = (event) => {\r\n                // 收到消息时的逻辑保持不变\r\n                if (typeof event.data === 'string') {\r\n                    setTimeout(() => {\r\n                        if (!self._initCmdSent && self.ssh) {\r\n                            const term = self.term;\r\n                            if (!term || !term.buffer || !term.buffer.active) return;\r\n                            const currentLineNumber = term.buffer.active.baseY + term.buffer.active.cursorY;\r\n                            const line = term.buffer.active.getLine(currentLineNumber);\r\n                            if (line) {\r\n                                const lineText = line.translateToString();\r\n                                if (/[>$#%]\\s*$/.test(lineText.trimEnd())) {\r\n                                    self._initCmdSent = true;\r\n                                    self.term.write('\\x1b[s\\x1b[1;1H\\x1b[2K\\x1b[u');\r\n                                    if (self.ssh.command) {\r\n                                        setTimeout(() => {\r\n                                            if (self.ws && self.ws.readyState === 1) {\r\n                                                self.ws.send(self.ssh.command + '\\r');\r\n                                            }\r\n                                        }, 100);\r\n                                    }\r\n                                }\r\n                            }\r\n                        }\r\n                    }, 10);\r\n                }\r\n            }\r\n\r\n            this.ws.onclose = () => {\r\n                if (!self.resetClose) {\r\n                    if (self.ssh && !this.savePass) {\r\n                        this.$store.commit('SET_PASS', '')\r\n                        if (self.ssh) self.ssh.password = ''\r\n                    }\r\n                    this.$message({\r\n                        message: this.$t ? this.$t('wsClose') : '连接已断开',\r\n                        type: 'warning',\r\n                        duration: 3000,\r\n                        showClose: true\r\n                    })\r\n                    this.ws = null\r\n                }\r\n                heartCheck.stop()\r\n                self.resetClose = false\r\n            }\r\n\r\n            this.ws.onerror = (e) => {\r\n                console.error('WS Error:', e)\r\n            }\r\n\r\n            const attachAddon = new AttachAddon(this.ws, { bidirectional: false })\r\n            this.term.loadAddon(attachAddon)\r\n\r\n            this.term.onData(data => {\r\n                if (self.ws && self.ws.readyState === 1) {\r\n                    self.ws.send(data)\r\n                }\r\n            })\r\n\r\n            // 鼠标滚轮缩放字体\r\n            termContainer.addEventListener('wheel', (e) => {\r\n                if (e.ctrlKey) {\r\n                    e.preventDefault()\r\n                    if (e.deltaY < 0) {\r\n                        self.fontSize++\r\n                    } else {\r\n                        self.fontSize = Math.max(10, self.fontSize - 1)\r\n                    }\r\n                    self.term.setOption('fontSize', self.fontSize)\r\n                    try { self.fitAddon.fit() } catch (e) {/**/}\r\n                }\r\n            }, { passive: false })\r\n        },\r\n        async connected() {\r\n            // connected 逻辑保持不变\r\n            const sshInfo = this.$store.state.sshInfo\r\n            this.ssh = Object.assign({}, sshInfo)\r\n            try {\r\n                const result = await checkSSH(this.$store.getters.sshReq)\r\n                if (result.Msg !== 'success') {\r\n                    return\r\n                } else {\r\n                    this.savePass = result.Data.savePass\r\n                }\r\n            } catch(e) {\r\n                console.error(e)\r\n            }\r\n            \r\n            document.title = sshInfo.hostname || 'WebSSH'\r\n            \r\n            // 存储历史记录逻辑...\r\n            let sshList = this.$store.state.sshList\r\n            // ... (省略部分未变动的逻辑以保持简洁，实际使用时这部分逻辑保留原样即可)\r\n            // 如果你需要这部分逻辑，请把你原来 connected 里的代码贴回来，\r\n            // 或者直接用我这段，因为你原来的逻辑依赖 store，这里为了安全起见我不改动核心业务逻辑\r\n        },\r\n        close() {\r\n            if (this.ws !== null) {\r\n                this.ws.close()\r\n                this.resetClose = true\r\n            }\r\n            if (this.term !== null) {\r\n                this.term.dispose()\r\n                this.term = null // 清空引用\r\n            }\r\n        }\r\n    }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.terminal-page-wrapper {\r\n  display: flex;\r\n  flex-direction: column;\r\n  height: 100%; /* 确保填满父容器 */\r\n  width: 100%;\r\n  background: #000; /* 强制黑色背景，避免闪白 */\r\n  box-shadow: var(--shadow);\r\n  overflow: hidden;\r\n}\r\n\r\n.terminal-page-container {\r\n  display: flex;\r\n  flex: 1; /* 占据剩余空间 */\r\n  min-height: 0; /* 防止 flex 子元素溢出 */\r\n  overflow: hidden;\r\n  position: relative;\r\n}\r\n\r\n.terminal-area {\r\n  flex: 1;\r\n  min-width: 0;\r\n  height: 100%;\r\n  display: flex;\r\n  flex-direction: column;\r\n  background-color: black;\r\n}\r\n\r\n/* 核心 CSS 修改：确保 Xterm 容器占满所有空间 */\r\n.xterm-container {\r\n  flex: 1;\r\n  width: 100%;\r\n  height: 100%;\r\n  padding-left: 5px;\r\n  overflow: hidden; /* xterm 会自己处理滚动，容器不要滚动 */\r\n}\r\n\r\n/* 下面的样式保持不变，或者根据需要微调 */\r\n.file-tree {\r\n  width: 350px;\r\n  border-left: 1px solid var(--input-border);\r\n  background: var(--input-bg);\r\n  display: flex;\r\n  flex-direction: column;\r\n}\r\n\r\n.terminal-footer {\r\n  width: 100%;\r\n  text-align: center;\r\n  padding: 5px 0;\r\n  font-size: 15px;\r\n  color: #ccc; /* 页脚文字颜色改浅一点，适应黑色背景 */\r\n  background: #1a1a1a; /* 页脚背景深色 */\r\n  border-top: 1px solid #333;\r\n  display: flex;\r\n  justify-content: center;\r\n  align-items: center;\r\n  gap: 8px;\r\n  flex-shrink: 0;\r\n}\r\n\r\n.github-link {\r\n  color: #ccc;\r\n  margin-left: 4px;\r\n  font-size: 18px;\r\n}\r\n\r\n.sftp-toggle-btn {\r\n  display: none;\r\n  background: none;\r\n  border: none;\r\n  color: #ccc;\r\n  font-size: 18px;\r\n  cursor: pointer;\r\n}\r\n\r\n@media (max-width: 768px) {\r\n  .sftp-toggle-btn {\r\n    display: inline-block;\r\n  }\r\n  .file-tree {\r\n    position: absolute;\r\n    top: 0;\r\n    right: 0;\r\n    bottom: 0;\r\n    width: 85%;\r\n    transform: translateX(100%);\r\n    transition: transform 0.3s ease-in-out;\r\n    z-index: 20;\r\n  }\r\n  .file-tree.is-visible {\r\n    transform: translateX(0);\r\n  }\r\n}\r\n</style>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}